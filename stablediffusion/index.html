<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Stable Diffusion</title>
  <!--Bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/js/bootstrap.min.js" integrity="sha512-fHY2UiQlipUq0dEabSM4s+phmn+bcxSYzXP4vAXItBvBHU7zAM/mkhCZjtBEIJexhOMzZbgFlPLuErlJF2b+0g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css" integrity="sha512-Z/def5z5u2aR89OuzYcxmDJ0Bnd5V1cKqBEbvLOiUNWdg9PQeXVvXLI90SE4QOHGlfLqUnDNVAYyZi8UwUTmWQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body >
    <label for="promptInput" class="form-label">Prompt:</label>
    <input type="text" id="promptInput" class="form-control" placeholder="Prompt">
    <br>
    <label for="negativePromptInput" class="form-label">Negative Prompt:</label>
    <input type="text" id="negativePromptInput" class="form-control" placeholder="Negative prompt">
    <br>
    <label for="authTokenInput" class="form-label">Deepinfra API token:</label>
    <input type="password" id="authTokenInput" class="form-control" placeholder="Deepinfra API token">
    <br>
    <label for="heightInput" class="form-label">Height:</label>
    <input type="number" id="heightInput" class="form-control" value="512" placeholder="height">
    <br>
    <label for="widthInput" class="form-label">Width:</label>
    <input type="number" id="widthInput" class="form-control" value="512" placeholder="width">
    <br>
    <label for="numInferenceStepsInput" class="form-label">Number of inference steps:</label>
    <input type="number" id="numInferenceStepsInput" class="form-control" value="25" placeholder="Number of inference steps">
    <br>
    <label for="guidanceScaleInput" class="form-label">Guidance Scale:</label>
    <input type="number" id="guidanceScaleInput" class="form-control" value="7.5" placeholder="guidanceScale">
    <br>
    <label for="seedInput" class="form-label">Seed:</label>
    <input type="number" id="seedInput" class="form-control" value="0" placeholder="Seed">
    <br>
    <label for="modelSelect" class="form-label">Model:</label>
    <select id="modelSelect" class="form-select">
      <option value="Lykon/DreamShaper">Lykon/DreamShaper</option>
      <option value="prompthero/openjourney">prompthero/openjourney</option>
      <option value="XpucT/Deliberate">XpucT/Deliberate</option>
      <option value="runwayml/stable-diffusion-v1-5">runwayml/stable-diffusion-v1-5</option>
    </select>
    <br>
    <button id="generateButton" class="btn btn-primary">Generate image</button>
    <br><br>
    <img id="generatedImage" width="512" height="512">
</body>
<script type="module">

document.getElementById('generateButton').addEventListener('click', generateImage);
async function generateImage(){
  const authToken = document.getElementById('authTokenInput').value;
  const prompt = document.getElementById('promptInput').value;
  const negativePrompt = document.getElementById('negativePromptInput').value;
  const height = document.getElementById('heightInput').value;
  const width = document.getElementById('widthInput').value;
  const guidanceScale = document.getElementById('guidanceScaleInput').value;
  const numInferenceSteps = document.getElementById('numInferenceStepsInput').value;
  const seed = document.getElementById('seedInput').value;
  const model = document.getElementById('modelSelect').value;

  const formData = new FormData();
  formData.append('prompt', prompt);
  formData.append('negative_prompt', negativePrompt);
  formData.append('height', height);
  formData.append('width', width);
  formData.append('guidance_scale', guidanceScale);
  formData.append('num_inference_steps', numInferenceSteps);
  if (seed > 0){
    formData.append('seed', seed);
  }
  
  const requestOptions = {
    method: 'POST',
    headers: {
      'Authorization': `bearer ${authToken}`,
    },
    body: formData
  };
  
  try {
    const url = `https://api.deepinfra.com/v1/inference/${model}`;
    const response = await fetch(url, requestOptions);
    const data = await response.json();
    console.log("API response:",data);
    
    if (data.images && data.images.length > 0) {
      const imageElement = document.getElementById('generatedImage');
      imageElement.src = data.images[0];
    }
  } catch (error) {
    console.error('There was an error while making the request:', error);
  }
}
</script>
</html>
